<!DOCTYPE html>
<html lang="en">
{% load static %}
{% load crispy_forms_tags %}

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Mukjagolmok</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="{% static 'assets/img/food.png' %}" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v5.15.1/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'css/styles-golmok.css' %}" rel="stylesheet" />
    </head>

<body id="page-top">

       <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" href="/mukja/index/">Map of Seoul Food Alley</a>
                <button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/mukja/index/">Food Alley</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="/mukja/aboutus/">About</a></li>
                        {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle py-3 px-0 px-lg-3 rounded js-scroll-trigger" data-toggle="dropdown" href="#" id="download">{{ user }} <span class="caret"></span></a>
                            <div class="dropdown-menu" aria-labelledby="download">
                                {#                        <a class="dropdown-item" href="https://jsfiddle.net/bootswatch/3he50zsf/">Open in JSFiddle</a>#}
                                {#                        <div class="dropdown-divider"></div>#}
                                {#                        <a class="dropdown-item" href="../4/simplex/bootstrap.min.css">bootstrap.min.css</a>#}
                                {#                        <a class="dropdown-item" href="../4/simplex/bootstrap.css">bootstrap.css</a>#}
                                {#                        <div class="dropdown-divider"></div>#}
                                {#                        <a class="dropdown-item" href="../4/simplex/_variables.scss">_variables.scss</a>#}
                                <a class="dropdown-item" href="{% url 'logout' %}">Log out</a>
                            </div>
                        </li>
                        {% else %}
                        <li class="nav-item">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#loginModal">
                                Log in
                            </button>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </nav>

        {% load socialaccount %}

       <!-- Modal -->
        <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Please Log in</h5>
                        <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class = 'row'>
                            <div class="col-md-6">
                                <a role = 'button' class="btn btn-outline-primary" href="{% provider_login_url 'google'%}"><i class="fab fa-google"></i> Log in with Google</a>
                                <a role = 'button' class="btn btn-outline-info" href="{% url 'login' %}"><i class="far fa-envelope"></i> Log in with Email</a>

                            </div>
                            <div class="col-md-6">
                                <a role = 'button' class="btn btn-outline-info" href="{% url 'register' %}"><i class="far fa-envelope"></i> Sign Up with Email</a>

                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

       <br><br><br><br><br>

<!-- Page Content -->
<div class="container">

  <div class="row">

    <!-- Post Content Column -->
    <div class="col-lg-8">

      <!-- Title -->
      <h1 class="mt-4">{{ restaurant.name|linebreaksbr }}</h1>

      <hr>

      <!-- Preview Image -->
      <img width="280" class="img-fluid rounded" src="{{ restaurant.head_image.url }}" alt="">

        <hr>

      <!-- Date/Time -->
      <h5>Contact Number : {{ restaurant.phone_number }}</h5>
      <h5>Address : {{ restaurant.address }}</h5>

      <hr>
      <h5 class="card-text">MENU</h5>
      {% for menu in menus %}
      <p> {{ menu.name }} : {{ menu.price }} </p>
      {% endfor %}

      <div class="card my-4">
        <h5 class="card-header">Leave a Comment:</h5>
        <div class="card-body" >
          <form method="post" action="{{ restaurant.get_absolute_url }}new_comment/">
            {% csrf_token %}
            <div class="form-group">
              {{ comment_form | crispy }}
            </div>
              {% if request.user.is_authenticated %}
              <button type="submit" class="btn btn-primary">Submit</button>

              {% else %}
              <p>로그인 하셔야 합니다.</p>

              {% endif %}
          </form>
        </div>
      </div>

      <div id = "comment-list">
        <!-- Single Comment -->
        {% for c in comment %}
        <div class="media mb-4" id = "comment-id-{{ c.pk }}">
          <img class="d-flex mr-3 rounded-circle" src="http://placehold.it/50x50" alt="">
          <div class="media-body">
            {% if c.author == request.user %}
<!--            <button class="btn btn-sm btn-info float-right" onclick="location.href='/mukja/edit_comment/{{ c.pk }}/'">edit</button>-->
                <button class="btn btn-sm btn-warning float-right" data-toggle="modal" data-target="#deleteCommentModal-{{ c.pk }}">delete</button>
<!--                <button class="btn btn-sm btn-warning float-right" onclick="location.href='/mukja/delete_comment/{{ c.pk }}/'">delete</button>&ndash;&gt;-->

            {% endif %}
            <h5 class="mt-0">{{ c.author }} <small class="text-muted">{{ c.created_at }}</small></h5>
            {{ c.get_markdown_content | safe}}
          </div>
        </div>
        {% endfor %}
      </div>

      {% for c in comment %}
      {% if request.user == c.author %} <!-- user는 request.user랑 똑같음!! -->

        <!-- Modal -->
      <div class="modal fade" id="deleteCommentModal-{{ c.pk }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">정말로 삭제하시겠습니까?</h5>
            </div>
            <div class="modal-body">
              <!-- 댓글 내용을 보여주기 위함 -->
              <p>{{ c.get_markdown_content | safe }}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" onclick="location.href='/mukja/delete_comment/{{ c.pk }}/'">Delete</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>

            </div>
          </div>
        </div>
      </div>
      {% endif %}
      {% endfor %}


    </div>

    <!-- Sidebar Widgets Column -->
    <div class="col-md-4">

      <!-- Side Widget -->
      <div class="card my-4">
        <h5 class="card-header">Map of restaurant</h5>
        <div class="card-body">
          <!-- kakao map-->
          <div id="map" style="width:100%;height:300px;"></div>
          <div id="lat" style="display: none" >{{ restaurant.latitude }}</div>
          <div id="lng" style="display: none" >{{ restaurant.longitude }}</div>
          <!-- kakao map end -->
        </div>
      </div>
    </div>
  </div>
  <!-- /.row -->

</div>
<!-- /.container -->

<!-- Footer -->
<footer class="py-5 bg-dark">
  <div class="container">
    <p class="m-0 text-center text-white">Copyright &copy; Mukjagolmok</p>
  </div>
  <!-- /.container -->
</footer>

<!-- Bootstrap core JavaScript -->
<script src="{% static 'js/jquery1.min.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1cc2187c8717ffab77eb12ceab5806ae"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
<script src="{% static 'js/scripts.js' %}"></script>
<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/parallax.min.js' %}"></script>
<script>
  // 마커가 표시될 위치입니다
  var data_lat = document.getElementById("lat").innerText;
  var data_lng = document.getElementById("lng").innerText;
  var markerPosition = new kakao.maps.LatLng(data_lat, data_lng);
  console.log(data_lat, data_lng)
  var mapContainer = document.getElementById('map'), // 지도를 표시할 div
      mapOption = {
          center: new kakao.maps.LatLng(data_lat, data_lng), // 지도의 중심좌표
          level: 3 // 지도의 확대 레벨
      };

  var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다



  // 마커를 생성합니다
  var marker = new kakao.maps.Marker({
      position: markerPosition
  });

  // 마커가 지도 위에 표시되도록 설정합니다
  marker.setMap(map);

  // 아래 코드는 지도 위의 마커를 제거하는 코드입니다
  // marker.setMap(null);
  // 지도를 표시하는 div 크기를 변경하는 함수입니다
  // map.relayout();
  </script>

</body>

</html>
